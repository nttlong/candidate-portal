<!DOCTYPE html>
<html>
<head>
    <title>page-caption:(My Resume)</title>
    <meta charset="utf-8" />
    <render>../commons/header.html</render>
    <link href="{{Config.RootUrl}}Templates/default/resources/css/candidate_account.min.css" rel="stylesheet" />
    <script src="{{Config.RootUrl}}Scripts/bootstrap-datepicker.js"></script>
    <link href="{{Config.RootUrl}}Content/css/bootstrap-datepicker3.min.css" rel="stylesheet" />
    <script src="{{Config.RootUrl}}Scripts/moment.min.js"></script>
    <script src="{{Config.RootUrl}}Scripts/vue.min.js"></script>
    <script src="{{Config.RootUrl}}Scripts/toastr.min.js"></script>
    <link href="{{Config.RootUrl}}Content/toastr.min.css" rel="stylesheet" />

</head>
<body>
    <render>../commons/navbar.html</render>
    {{#data}}
    <div class="wrapper"  id="app">
        <section class="container myresume-content">
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-12">
                    <div class="header_box">
                        <div class="pull-left">
                            res:(Tài Khoản)
                        </div>
                        <div class="pull-right">
                            <button type="submit" class="btn btn-info" v-on:click="SaveCandidate()">res:(Lưu)</button>
                        </div>
                        <div style="clear:both; font-size:1px;"></div>
                    </div>
                    <div style="display: none" class="alert alert-success" id="success" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <strong>res:(Lưu tài khoản thành công)!</strong>
                    </div>
                    <div style="display: none" class="alert alert-danger" id="danger" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <strong>res:(Lưu tài khoản thất bại)!</strong>
                    </div>
                    <div class="myresume-detail">
                        <div class="box">
                            <div class="box_title"><strong>res:(Cập nhật tài khoản)</strong></div>
                            <!--///-->
                            <div class="myresume-user-infor">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="item_box">
                                            <div class="header_item_box">
                                                <strong>res:(ĐĂNG NHẬP BẰNG EMAIL CÁ NHÂN)</strong>
                                            </div>
                                            <div class="body_item_box">
                                                <form class="form-horizontal">
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Email/Login ID)</label>
                                                        <div class="col-sm-4">
                                                            <input class="form-control" id="focusedInput" type="text" v-model="data.infoUser.Email" placeholder="res:(Email/Login ID)">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Mật khẩu)</label>
                                                        <div class="col-sm-4">
                                                            <input class="form-control" id="focusedInput" type="text" v-model="data.infoUser.Password" placeholder="res:(Mật khẩu)">
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <div class="item_box">
                                            <div class="header_item_box">
                                                <strong>res:(ĐĂNG NHẬP BẰNG TÀI KHOẢN MẠNG XÃ HỘI)</strong>
                                            </div>
                                            <div class="body_item_box">
                                                <form class="form-horizontal">
                                                    <div class="form-group">
                                                        <div class="col-sm-2 col-md-2">
                                                            <button type="button" class="btn btn-sm btn-li control-label"><i class="fa fa-linkedin left"></i> res:(Linkedin)</button>
                                                        </div>
                                                        <div class="col-sm-4 col-md-4">
                                                            <input class="form-control" id="focusedInput" type="text" v-model="data.infoUser.UserLinkedIn" placeholder="res:(Linkedin)">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <div class="col-sm-2">
                                                            <button type="button" class="btn btn-sm btn-fb control-label"><i class="fa fa-facebook left"></i> res:(Facebook)</button>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <input class="form-control" id="focusedInput" type="text" v-model="data.infoUser.UserFacebook" placeholder="res:(Facebook)">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <div class="col-sm-2">
                                                            <button type="button" class="btn btn-sm btn-tw control-label"><i class="fa fa-twitter left"></i> res:(Twitter)</button>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <input class="form-control" id="focusedInput" type="text" v-model="data.infoUser.UserTwitter" placeholder="res:(Twitter)">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <div class="col-sm-2">
                                                            <button type="button" class="btn btn-sm btn-gplus control-label"><i class="fa fa-google-plus left"></i> res:(Google +)</button>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <input class="form-control" id="focusedInput" type="text" v-model="data.infoUser.UserGoogle" placeholder="res:(Google +)">
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <div class="item_box">
                                            <div class="header_item_box">
                                                <strong>res:(THÔNG TIN CÁ NHÂN)</strong>
                                            </div>
                                            <div class="body_item_box">
                                                <form class="form-horizontal">
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Họ) <span>*</span></label>
                                                        <div class="col-sm-6">
                                                            <input class="form-control" id="focusedInput" type="text" placeholder="res:(Họ và tên)" v-model="data.infoUser.LastName">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Tên) <span>*</span></label>
                                                        <div class="col-sm-6">
                                                            <input class="form-control" id="focusedInput" type="text" placeholder="res:(Họ và tên)" v-model="data.infoUser.FirstName">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Giới tính)</label>
                                                        <div class="col-sm-2">
                                                            <select class="form-control" id="sexlist" v-model="data.infoUser.SelectedSex">
                                                                <option value="true" >Nam</option>
                                                                <option value="flase" >Nữ</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Ngày sinh)</label>
                                                        <div class="col-sm-6">
                                                            <input style="width: 40%" class="form-control edit-control datepicker" id="birthDate" v-model="formatDate(data.infoUser.BirthDate, 'MM/DD/YYYY')">
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Tình trạng hôn nhân)</label>
                                                        <div class="col-sm-2" >
                                                            <select class="form-control" id="selectMarriages" v-on:click="onLoadMarriagesName($event)" v-model="data.infoUser.SelectedMarriageStatus">
                                                                {{#eachItemInArray '$listItemMarriages'}}
                                                                <option value="{{getValue '$Code'}}">{{getName '$Name'}}</option>
                                                                {{/eachItemInArray}}
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Ảnh của bạn)</label>
                                                        <div class="col-sm-2">
                                                            <input type="file" @change="onFileChange"/>
                                                            <span>(JPEG/PNG/GIF, ≤ 1MB)</span>
                                                            <div>
                                                                <img :src="data.infoUser.Photo" width="96" height="96"/> <label><input type="checkbox" v-model="data.checked">res:(Xóa)</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Địa chỉ)</label>
                                                        <div class="col-sm-6">
                                                            <input class="form-control" id="focusedInput" type="text" v-model="data.infoUser.Address" placeholder="res:(Địa chỉ)">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Tỉnh) <span>*</span></label>
                                                        <div class="col-sm-6">
                                                            <select class="form-control" v-on:click="onLoadLocationName($event)">
                                                                {{#eachItemInArray '$listItemLocations'}}
                                                                <option value="{{getValue '$Code'}}">{{getName '$Name'}}</option>
                                                                {{/eachItemInArray}}
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Quốc gia) <span>*</span></label>
                                                        <div class="col-sm-6">
                                                            <select class="form-control" id="selectNations" v-on:click="onLoadNationName($event)" v-model="data.infoUser.SelectedNations">
                                                                {{#eachItemInArray '$listItemNations'}}
                                                                <option value="{{getValue '$Code'}}">{{getName '$Name'}}</option>
                                                                {{/eachItemInArray}}
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Điện thoại)</label>
                                                        <div class="col-sm-6">
                                                            <input class="form-control" id="focusedInput" type="text" v-model="data.infoUser.Tel" placeholder="res:(Điện thoại)">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Di động)</label>
                                                        <div class="col-sm-6">
                                                            <input class="form-control" id="focusedInput" v-model="data.infoUser.Mobile" type="text" placeholder="res:(Di động)">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">res:(Nhận bản tin việc làm) <span>*</span></label>
                                                        <div class="col-sm-6">
                                                            <select class="form-control" v-model="data.infoUser.IsAutoReceiveNews">
                                                                <option value="true">Có</option>
                                                                <option value="false">Không</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    {{/data}}
    <script>
        function formatDate(value, format) {
            return moment(String(value)).format(format)
        }
        (function () {            
            var ajaxLoadData = "ajax.store.st_get_account_id_apply_load";
            var app = {
                data: {
                    checked: false,
                    infoUser: {
                        LastName: {},
                        FirstName: {},
                        Password: {},
                        Photo: {},
                        UserFacebook: {},
                        UserGoogle: {},
                        UserLinkedIn: {},
                        UserOther: {},
                        UserTwitter: {},
                        Email: {},
                        Address: {},
                        Tel: {},
                        Mobile: {},
                        SelectedSex: {},
                        SelectedMarriageStatus: {},
                        SelectedNations: {},
                        IsAutoReceiveNews: {},
                        BirthDate: {},
                        listItemLocations: {}
                    }
                },
                doLoadData: function () {
                    ajaxLoadData.done(function (res) {
                        console.log(res);
                        var lang = "{{Language.Current.Code}}";
                        app.data.infoUser.LastName = res.LastName;
                        app.data.infoUser.FirstName = res.FirstName;
                        app.data.infoUser.Password = res.Password;
                        app.data.infoUser.Photo = res.Photo;
                        app.data.infoUser.UserFacebook = res.UserFacebook;
                        app.data.infoUser.UserGoogle = res.UserGoogle;
                        app.data.infoUser.UserLinkedIn = res.UserLinkedIn;
                        app.data.infoUser.UserOther = res.UserOther;
                        app.data.infoUser.UserTwitter = res.UserTwitter;
                        app.data.infoUser.Email = res.Email;
                        app.data.infoUser.Address = res.FullAddress;
                        app.data.infoUser.Tel = res.Tel;
                        app.data.infoUser.Mobile = res.Mobile;
                        app.data.infoUser.SelectedSex = res.Sex.toString();
                        app.data.infoUser.listItemMarriages = res.listItemMarriages; 
                        app.data.infoUser.SelectedMarriageStatus = res.MarriageStatus.Code;
                        app.data.infoUser.SelectedMarriageName = res.MarriageStatus.Name;
                        app.data.infoUser.listItemNations = res.listItemNations;
                        app.data.infoUser.SelectedNations = res.Nationality.Code;
                        app.data.infoUser.SelectedNationsName = res.Nationality.Name;
                        app.data.infoUser.IsAutoReceiveNews = res.IsAutoReceiveNews.toString();
                        app.data.infoUser.BirthDate = res.BirthDate;
                        app.data.infoUser.listItemLocations = res.listItemLocations;
                    });
                },
                onLoadLocationName: function (event) {
                    var arr = app.data.infoUser.listItemLocations;
                    var result = $.grep(arr, function (e) { return e.Code == event.target.value; });
                    app.data.infoUser.listItemLocationsName = result[0].Name;
                },
                onLoadMarriagesName: function (event) {
                    var arr = app.data.infoUser.listItemMarriages;
                    var result = $.grep(arr, function (e) { return e.Code == event.target.value; });
                    app.data.infoUser.SelectedMarriageName = result[0].Name;
                },
                onLoadNationName: function (event) {
                    var arr = app.data.infoUser.listItemNations;
                    var result = $.grep(arr, function (e) { return e.Code == event.target.value; });
                    app.data.infoUser.SelectedNationsName = result[0].Name;
                }
            };
            app.doLoadData();
            new Vue({
                delimiters: ['${', '}'],
                el: '#app',
                //created: function() {
                //    this.dataFile = {};
                //},
                data: app,
                mounted() {
                    $("#birthDate").datepicker().on(
                          "changeDate", () => { app.data.infoUser.BirthDate = $('#birthDate').val() }
                      );
                    setTimeout(function () {
                        $('[name="ByLocation"]').select2({ placeholder: 'res:(Search by location)' });
                        $('[name="ByJob"]').select2({ placeholder: 'res:(Search by category)' });
                        $('[name="ByLocation"]').val("all").trigger("change")
                        $('[name="ByJob"]').val("all").trigger("change");
                    }, 0)
                },
                methods: {
                    onFileChange(e) {
                        var files = e.target.files || e.dataTransfer.files;
                        if (!files.length)
                            return;
                        this.createImage(files[0]);
                    },
                    createImage(file) {
                        var image = new Image();
                        var reader = new FileReader();
                        var vm = this;

                        reader.onload = (e) => {
                            app.data.infoUser.Photo = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    },
                    SaveCandidate() {
                        var data = app.data.infoUser;
                        
                        if (app.data.checked) {
                            data.Photo = "";
                        }
                        var ajaxLoadData = "ajax.store.st_save_data_account_candidate_to_ls_candidate";
                        ajaxLoadData.data({ data }).done(function (res) {
                            if (res.writeConcernError == undefined) {
                                toastr.success("res:(Sửa thành công)");
                            } else {
                                toastr.success("res:(Sửa thất bại)");
                            }
                        })
                    }
                }
            })
        })();
    </script>
</body>
</html>
